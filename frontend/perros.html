<!DOCTYPE html>
<html lang="es">
  
<!-- Barra -->
<head>
  <style>
    .form {
        margin: 1% 20% 5% 20%;
    }
    .terms {
        font-size: 40px;
    }
        html, body, main {
          margin: 0;
          padding: 0;
          height: 100%
        }
        
    </style>
  
  <title>Proyecto Pull Requesteros &#x1F3E1</title>
  <meta name="keywords" content="HTML, CSS, JavaScript">
  <meta name="author" content="Pull Requesteros">
  <meta viewport="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="public/veterinario.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
</head>


<body class="has-background-white">

  <main>
    <!-- Menu -->
    <header>
      <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
        <div class="navbar-start">
          <a class="navbar-item" href="index.html">
            Página Principal
            <img src="public/veterinario.png" alt="Perrito y gatito">
          </a>

          <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
          <div class="navbar-end">
            <a class="navbar-item" href="prueba_animales.html">
              <p>Adopta <img src="public/huella.png" alt="huella"></p>
            </a>
            <a class="navbar-item" href="refugios.html">
              <p>Refugios <img src="public/huella.png" alt="huella"></p>
            </a>

            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">
                <p>Más <img src="public/huella.png" alt="huella"></p>
              </a>
              <div class="navbar-dropdown is-right">
                <a class="navbar-item" href="mas/preguntas_fre.html">
                  Preguntas frecuentes
                </a>
                <a class="navbar-item" href="mas/formu_pre.html">
                  Formulario de pre-adopcion
                </a>
                <a class="navbar-item" href="mas/sobre_nosotros.html">
                  Sobre nosotros
                </a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>
    
        
    <div class="form">
      <h1 class="terms" style="margin: 0 0 5% 0">Registra a un animal</h1>
  
      <div class="field">
        <label class="label">Animal</label>
        <div class="control">
          <div class="select">
            <select class="tipo" id="tipo">
              <option selected value="Perro">Perro</option>
              <option value="Gato">Gato</option>
            </select>
          </div>
        </div>
      </div>
  
      <div class="field">
        <label class="label">Nombre</label>
        <div class="control">
          <input class="input" type="text" placeholder="Firulais">
        </div>
      </div>
  
      <div class="field">
        <label class="label">Edad</label>
        <div class="control">
          <input class="input" type="number" min="0" max="25" placeholder="Años">
        </div>
      </div>
  
  
      
      
      <div class="field">
        <label class="label">Raza</label>
        <div class="control">
          <div class="select">
            <select class="raza">
            </select>
          </div>
        </div>
      </div>
  
      <script>
        const dogBreeds = ["Labrador", "Bulldog", "Beagle", "Chihuahua"];
        const catBreeds = ["Persa", "Siamés", "Tigre"];
        
        document.getElementById('tipo').addEventListener('change', function() {
          const select = document.querySelector('.field .select .raza');
          select.innerHTML = ''; // Clear previous options
          const breeds = this.value === 'Perro' ? dogBreeds : catBreeds;
          breeds.forEach(breed => {
            const option = document.createElement('option');
            option.value = breed;
            option.textContent = breed;
            select.appendChild(option);
          });
        });
  
        document.getElementById('tipo').dispatchEvent(new Event('change'));
      </script>
  
      <div class="field">
        <div class="control">
          <label class="radio">
          <input type="radio" name="sexo" value="Macho">
          Macho
          </label>
          <label class="radio">
          <input type="radio" name="sexo" value="Hembra">
          Hembra
          </label>
        </div>
        </div>
      
  
      
      
      <div class="field">
        <div class="control">
          <label class="checkbox">
            <input type="checkbox">
            Estoy de acuerdo con los <a href="#"><button class="js-modal-trigger" data-target="modal-js-example">
        términos y condiciones
      </button></a>
          </label>
        </div>
      </div>
      
      
      <script src="script_formulario.js" defer></script>
      <div id="modal-js-example" class="modal">
        <div class="modal-background"></div>
        <div class="modal-content">
          <div class="box">
            <div class="terms">
            <p><strong>TÉRMINO Y CONDICIÓN:</strong> NO MALTRATAR A LOS ANIMALES</p>
            </div> 
            <img src="https://i.imgur.com/jptS5Xq.jpeg" width="90%">
            <!-- Your content -->
          </div>
        </div>
      
        <button class="modal-close is-large" aria-label="close"></button>
      </div>
      
  
      
      <div class="field is-grouped">
        <div class="control">
          <button class="button is-link" onclick="submitForm()">Submit</button>
        </div>
        <div class="control">
          <button class="button is-link is-light" onclick="resetForm()">Cancel</button>
        </div>
      </div>
  
      <script>
        const urlParams = new URLSearchParams(window.location.search);
        const refugioId = urlParams.get('refugioId');
        console.log('Refugio ID:', refugioId);
      </script>
  
      <script>
        function submitForm() {
          const nombre = document.querySelector('input[type="text"]').value;
          const edad = document.querySelector('input[type="number"]').value;
          const raza = document.querySelector('.field .select .raza').value;
          
          if (edad.trim() === '' || edad < 0 || edad > 25) {
            alert('Edad inválida.');
            return;
          }

          const sexo = document.querySelector('input[name="sexo"]:checked').value;
          const tipo = document.querySelector('.field .select .tipo').value;
          const terms = document.querySelector('input[type="checkbox"]').checked;
          //alert to debug data
          //alert(`Nombre: ${nombre}, Edad: ${edad}, Sexo: ${sexo}, Raza: ${raza}, Terms: ${terms}`);
          if (!terms) {
            alert('You must agree to the terms and conditions.');
            return;
          }
  
          let data = { nombre:nombre, edad:parseInt(edad), raza:raza, sexo:sexo, tipo:tipo};
  
          fetch('http://127.0.0.1:3000/api/v1/animales', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          })
          .then(response => response.json())
          .then(data => {
            console.log('Refugio ID:', refugioId);
            console.log('Animal ID:', data.id);
            const animalRefugioData = {
              refugio_id: refugioId,
              animal_id: data.id
            };
  
            fetch('http://127.0.0.1:3000/api/v1/animales_refugio', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(animalRefugioData),
            })
            .then(response => response.json())
            .then(data => {
              alert('Animal registrado correctamente!');
              window.top.location.href = 'prueba_animales.html';
            })
            .catch((error) => {
              alert('Se registró el animal pero no se pudo asociar al refugio.');
              window.top.location.href = 'prueba_animales.html';
            });
            
          })
          .catch((error) => {
            console.error('Error:', error);
            alert('Hubo un error registrando el animal.');
          });
        }
  
        //No se usa y andaría mal.
        function resetForm() {
          document.querySelector('input[type="text"]').value = '';
          document.querySelector('input[type="number"]').value = '';
          document.querySelector('.field .select select').value = 'Masculino';
          document.querySelectorAll('.field .select select')[1].value = '';
          document.querySelector('input[type="checkbox"]').checked = false;
        }
      </script>
  
  
  
    </div>
    <div class="modal">
      <div class="modal-background"></div>
      <div class="modal-content">
        <p class="image is-4by3">
          <img src="https://bulma.io/assets/images/placeholders/1280x960.png" alt="">
        </p>
      </div>
      <button class="modal-close is-large" aria-label="close"></button>
    </div>

</main>
    
</body>